# 実装計画メモ

## 完了した項目

1. フォーム UI の刷新  
   - 従来の自由入力チャットを閲覧専用に変更し、モードに応じた入力フィールドを定義しました。  
   - クライアント側で必須入力や数値範囲を検証し、その場でエラーメッセージを表示できるようにしました。  
   - 送信内容から構造化 JSON ペイロードを生成し、ワーカーへ投入する経路を整備しました。  
   - 現行プロセスで不要となった「共通参照URL／ファイル」「引用出力範囲」「バッチ行数」の入力フィールドを削除し、フォームを簡素化しました。  
   - 参照資料入力は専用セクションに整理し、オプション項目を視覚的にまとめて入力負荷を軽減しました。  
   - 参照フィールドはリモート URL のみを受け付ける方針に統一し、文言・バリデーションを順次見直す予定です。
2. チャット表示と操作系の整理  
   - 送信ボタンを廃止してフォーム内の「送信」「停止」操作に統合しました。  
   - 自動テスト経路をフォーム送信フローに合わせて更新しました。  
   - 直近入力値を保持したままフォームを再描画できるようにしました。
3. ワーカー処理の単純化  
   - ReAct ベースのレガシー処理を撤廃し、構造化タスクのみを受け付けるよう統一しました。  
   - フォーム固有フィールド（`sheet_name` など）の受け渡しと検証を整理しました。  
   - Excel／Copilot 由来の例外を UI に伝達できるようエラーハンドリングを強化しました。
4. ドキュメント整備  
   - `PROGRAM_SPEC.md` をフォーム運用前提の内容に更新しました。  
   - 本メモを最新の段取りに合わせて再整理しました。

## 次フェーズで引き継ぐタスク

- 代表的なフォーム入力ケースについて自動テスト（単体／統合）を追加し、回帰検証を容易にする。  
- フォーム定義やデフォルト値を外部設定化し、運用環境ごとにカスタマイズしやすくする。  
- 参照資料（URL）入力の UX を改善し、ドラッグ＆ドロップや最近使用した項目の候補表示を検討する。  
- UI のラベル／プレースホルダー文言と実装仕様（複数参照の扱い、ローカルファイル可否など）の差異を棚卸しし、必要に応じて文言・バリデーションを調整する。
