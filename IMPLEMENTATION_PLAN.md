## 実装計画: フォームベース入力への移行

1. **フォーム UI の設計と配置**  
   - モードごとの必須項目（セル範囲、出力列、参照 URL 等）を整理し、`desktop_app.py` もしくは新設する `ui/forms.py` にカスタムコントロールを実装する。  
   - 入力値の検証（空欄、セル範囲の形式、列数整合など）をクライアント側で行い、エラーはその場で表示する。  
   - 送信時にはフォーム値から JSON ペイロードを生成し、既存のリクエストキューへ投入する。  

2. **既存チャット入力との共存**  
   - フォームから送信された JSON と、自由入力の文字列をワーカー側で判別できるよう現在のロジックを確認する。  
   - UI ではフォーム送信とチャット送信を明確に区別し、誤送信を防ぐためのラベルや説明を追加する。  
   - フォーム入力後に同じ設定で再実行できるよう、直近のフォーム値を残す仕組み（保持またはプリセット保存）を検討する。  

3. **ワーカー処理の拡張**  
   - 受け取った JSON にフォーム特有のフィールド（例: `sheet_name`、`reference_urls` 配列など）が追加されても確実に読み取れるよう `_run_structured_task` を点検する。  
   - フォーム検証では拾いきれない例外（Excel 側エラーや Copilot 側応答失敗）を適切なメッセージで返し、UI に表示する。  

4. **ドキュメントとガイド更新**  
   - `PROGRAM_SPEC.md` や README 相当の資料をフォーム運用前提の内容に改訂する。  
   - 操作手順をスクリーンショット付きでまとめ、翻訳担当者が迷わず入力できるようにする。  

5. **動作確認と回帰テスト**  
   - 各モードでフォーム送信→Excel 書き込みが期待通りになるか手動で確認する。  
   - 同一条件をチャット入力で再現し、レガシーフローが引き続き動作することも検証する。  
   - キャンセルやブラウザリセット操作を試し、フォーム経由でも状態が破綻しないことを確認する。  
