        colon_pattern = r"\s*[:�F]"
        action_match = re.search(rf"Action{colon_pattern}", response, re.IGNORECASE)
        thought_match = re.search(rf"Thought{colon_pattern}", response, re.IGNORECASE)
        final_answer_match = re.search(rf"Final Answer{colon_pattern}", response, re.IGNORECASE)

        if action_match:
            if thought_match and thought_match.start() < action_match.start():
                thought = response[thought_match.end():action_match.start()].strip()
            elif thought_match:
                thought = response[thought_match.end():action_match.start()].strip()
            else:
                thought = response[:action_match.start()].strip()

            action_str_raw = response[action_match.end():].strip()
            json_payload = _extract_json_payload(action_str_raw)
            if not json_payload:
                raise LLMResponseError("ActionブロックからJSONが検出できませんでした。")
            return thought, json_payload, None

        if final_an